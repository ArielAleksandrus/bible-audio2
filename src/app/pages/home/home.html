<div *ngIf="!bibleData">
  <div class="loading-hint">
    <mat-spinner diameter="24"></mat-spinner>
    <span>Loading the Bible in your language</span>
    <br/>
    <span>Carregando a bíblia no seu idioma</span>
    <br/>
    <span>正在加载您语言的圣经</span>
  </div>
</div>

<div class="home-container" *ngIf="bibleData">
  <!-- ============================================= -->
  <!-- HERO / TÍTULO -->
  <!-- ============================================= -->
  <header class="hero-header">
    <mat-icon class="hero-icon">menu_book</mat-icon>
    <h1>{{ 'hero.title' | translate }}</h1>
    <p>{{ 'hero.subtitle' | translate }}</p>

    <!-- Área do botão OU progresso de download completo -->
    <div class="download-area" *ngIf="(progress$ | async) as progress">
      <!-- Botão: aparece só se NÃO estiver baixando e tiver espaço suficiente -->
      <div class="full-download-button-wrapper"
           *ngIf="availableMB > 1500 && progress.status !== 'running'">
        <button mat-raised-button
                color="primary"
                class="full-download-button"
                (click)="fullDownload()">
          <mat-icon>download</mat-icon>
          {{ 'hero.full_download' | translate }}
        </button>
        <p class="full-download-description">
          {{ 'hero.full_download_description' | translate }}
          <mat-icon class="warning-icon">warning</mat-icon>
        </p>
      </div>

      <!-- Progresso: aparece apenas durante o download da Bíblia inteira -->
      <div class="full-download-progress"
           *ngIf="progress.status === 'running' && progress.total > 0">
        <p class="progress-title">
          {{ 'hero.downloading_bible' | translate:{ downloaded: progress.downloaded, total: progress.total } }}
        </p>
        <mat-progress-bar
          mode="determinate"
          [value]="(progress.downloaded / progress.total) * 100">
        </mat-progress-bar>
        <small class="current-chapter">
          {{ progress.currentTrack?.title || '-' }}
        </small>
      </div>

      <!-- Mensagem de conclusão -->
      <div class="download-complete" *ngIf="progress.status === 'completed'">
        <mat-icon color="primary">check_circle</mat-icon>
        <span>{{ 'hero.download_complete' | translate }}</span>
      </div>
    </div>

    <!-- Caso ainda não tenha iniciado nenhum download (progress$ emite inicial como idle ou null) -->
    <div class="download-area" *ngIf="!(progress$ | async) && availableMB > 1500">
      <div class="full-download-button-wrapper">
        <button mat-raised-button
                color="primary"
                class="full-download-button"
                (click)="fullDownload()">
          <mat-icon>download</mat-icon>
          {{ 'hero.full_download' | translate }}
        </button>
        <p class="full-download-description">
          {{ 'hero.full_download_description' | translate }}
          <mat-icon class="warning-icon">warning</mat-icon>
        </p>
      </div>
    </div>

    <!-- Verificação de itens já baixados (painting) -->
    <div class="loading-hint" *ngIf="painting">
      <mat-spinner diameter="24"></mat-spinner>
      <span>{{ 'loading.checking' | translate }}</span>
    </div>
  </header>

  <!-- ============================================= -->
  <!-- BIBLE PICKER -->
  <!-- ============================================= -->
  <section class="picker-section">
    <div class="picker-wrapper">
      <bible-picker
        [bible]="bibleData"
        [select]="'chapters'"
        [customCSS]="customCSS"
        (onSelecting)="bpSelecting($event)"
        (onSelected)="bpSelected($event)">
      </bible-picker>
    </div>
  </section>

  <!-- ============================================= -->
  <!-- LEGENDA DE CORES -->
  <!-- ============================================= -->
  <section class="legend-section">
    <div class="legend-items">
      <div class="legend-item">
        <span class="square-color partial-dl"></span>
        <span class="label">{{ 'legend.partial' | translate }}</span>
      </div>
      <div class="legend-item">
        <span class="square-color full-dl"></span>
        <span class="label">{{ 'legend.full' | translate }}</span>
      </div>
    </div>
  </section>
</div>
